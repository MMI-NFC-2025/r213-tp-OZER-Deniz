---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import { getOffres } from "../js/backend.mjs";

const offres = await getOffres();
console.log("Nombre d'offres:", offres.length);
console.log("Première offre:", offres[0]);
---

<Layout titre="Offres">
    <h1>Offres</h1>
    <p>Nombre d'offres chargées: {offres.length}</p>
    <button id="favori-button">Afficher les favoris</button>
    <div class="grille">
        {
            offres.map((offre) => (
                <div class="offre" data-favori={offre.Favori?.toString()}>
                    <Card offre={offre} />
                </div>
            ))
        }
    </div>
</Layout>

<style>
    .grille {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    #favori-button {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        font-size: 1rem;
        font-weight: 500;
        color: #2c3e50;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition:
            transform 0.2s ease,
            box-shadow 0.2s ease,
            background-color 0.2s ease;
    }

    #favori-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        background-color: #3498db;
        color: white;
    }

    #favori-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
</style>

<script>
    const button = document.getElementById("favori-button");
    let showOnlyFavorites = false;

    button?.addEventListener("click", () => {
        showOnlyFavorites = !showOnlyFavorites;
        const offres = document.querySelectorAll<HTMLElement>(".offre");

        offres.forEach((offre) => {
            const isFavori = offre.dataset.favori === "true";

            if (showOnlyFavorites) {
                offre.style.display = isFavori ? "block" : "none";
                button.textContent = "Afficher tout";
            } else {
                offre.style.display = "block";
                button.textContent = "Afficher les favoris";
            }
        });
    });
</script>
